# JsonEditor - Руководство пользователя

## Обзор

JsonEditor - это инструмент для редактирования игровых данных SimpleDungeon. Он был полностью обновлен для работы с новой системой диалогов и квестов.

## Основные возможности

### 1. Редактирование данных
- **Предметы** - создание и редактирование предметов
- **NPC** - настройка персонажей, торговцев, диалогов
- **Монстры** - создание врагов
- **Локации** - настройка игровых зон
- **Квесты** - создание расширенных квестов с условиями
- **Диалоги** - редактирование диалогов новой системы

### 2. Новая система диалогов

#### Структура диалогов
- **DialogueDocument** - документ диалога с ID, именем и стартовым узлом
- **DialogueNode** - узел диалога с текстом, типом и ответами
- **Response** - ответ игрока с условиями и действиями
- **DialogueAction** - действие, выполняемое при выборе ответа

#### Типы узлов
- `greeting` - приветствие
- `quest_offer` - предложение квеста
- `quest_progress` - квест в процессе
- `quest_complete` - завершение квеста
- `trade` - торговля
- `default` - обычный диалог

#### Условия видимости ответов
- `questAvailableForNPC:5001` - квест доступен для NPC
- `questInProgressForNPC:5001` - квест в процессе у NPC
- `questReadyToCompleteForNPC:5001` - квест готов к завершению
- `HasItem:1002` - у игрока есть предмет
- `FlagSet:flag_name` - установлен флаг

#### Действия ответов
- `StartQuest` - начать квест
- `CompleteQuest` - завершить квест
- `StartTrade` - открыть торговлю
- `EndDialogue` - закрыть диалог
- `GiveGold` - дать золото
- `GiveItem` - дать предмет
- `SetFlag` - установить флаг

### 3. Система квестов

#### Структура квеста
- **Основная информация** - ID, имя, описание, квестодатель
- **Условия** - что нужно выполнить для завершения
- **Награды** - золото, опыт, предметы
- **Диалоги** - ID узлов для разных состояний квеста
- **Предварительные условия** - какие квесты должны быть завершены

#### Узлы диалогов квеста
- **Offer** - узел предложения квеста (обязательный)
- **InProgress** - узел квеста в процессе
- **ReadyToComplete** - узел готовности к завершению
- **Completed** - узел завершенного квеста

### 4. Валидация синхронизации

#### Проверки
- **Диалоги и квесты** - корректность ссылок между системами
- **NPC торговцы** - существование товаров для продажи
- **Квестодатели** - существование NPC, дающих квесты
- **Целевые узлы** - существование узлов, на которые ссылаются ответы

#### Использование
1. Откройте меню "Инструменты"
2. Выберите "Проверить синхронизацию с runtime"
3. Просмотрите результаты валидации

## Работа с JsonEditor

### Открытие файла
1. Меню "Файл" → "Открыть..."
2. Выберите `game_data.json`
3. Данные загрузятся во вкладки

### Редактирование элементов
1. Выберите вкладку с нужным типом данных
2. Дважды кликните на элемент для редактирования
3. Используйте PropertyGrid справа для быстрого редактирования

### Создание новых элементов
1. Меню "Данные" → выберите тип → "Добавить [тип]"
2. Заполните необходимые поля
3. Сохраните изменения

### Редактирование диалогов
1. Выберите вкладку "Dialogues"
2. Дважды кликните на диалог
3. Используйте новый редактор диалогов:
   - Левая панель: документ и узлы
   - Средняя панель: редактирование узла
   - Правая панель: ответы и действия

### Редактирование квестов
1. Выберите вкладку "Quests"
2. Дважды кликните на квест
3. Используйте расширенный редактор квестов:
   - Основное: базовая информация
   - Условия: что нужно выполнить
   - Награды: что получит игрок
   - Диалоги: ID узлов для состояний
   - Предварительные условия: зависимости

## Советы по использованию

### Создание диалогов
1. Создайте DialogueDocument с уникальным ID
2. Добавьте узлы с разными типами
3. Настройте ответы с условиями и действиями
4. Проверьте синхронизацию

### Создание квестов
1. Укажите квестодателя (NPC должен существовать)
2. Добавьте условия выполнения
3. Настройте награды
4. Укажите ID узлов диалогов (будут созданы автоматически)
5. Проверьте синхронизацию

### Торговля
1. Для NPC-торговца добавьте Merchant с ItemsForSale
2. Убедитесь, что все товары существуют в Items
3. Проверьте синхронизацию

## Устранение проблем

### Ошибки валидации
- **Квест ссылается на несуществующего NPC** - создайте NPC или измените QuestGiverID
- **NPC ссылается на несуществующий диалог** - создайте диалог или измените DefaultDialogueId
- **Торговец продает несуществующие товары** - создайте предметы или удалите из ItemsForSale

### Проблемы с диалогами
- **Ответ ссылается на несуществующий узел** - создайте узел или измените Target
- **Условие не работает** - проверьте синтаксис условия
- **Действие не выполняется** - проверьте параметры действия

### Проблемы с квестами
- **Квест не предлагается** - проверьте QuestGiverID и Offer узел
- **Квест не завершается** - проверьте условия и ReadyToComplete узел
- **Награды не выдаются** - проверьте настройки Rewards

## Заключение

JsonEditor теперь полностью синхронизирован с runtime системой и поддерживает все новые возможности диалогов и квестов. Используйте валидацию для проверки корректности данных перед сохранением.
